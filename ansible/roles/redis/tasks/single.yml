---
- name: Install Redis server
  apt: name=redis-server state=present

- name: Configure redis to listen on the docker0 interface
  action: lineinfile dest=/etc/redis/redis.conf regexp="^bind\s+127.0.0.1" line="bind 127.0.0.1 172.17.0.1 {{Â hostvars[inventory_hostname]['ansible_eth1']['ipv4']['address'] if 'backend_servers' in groups else '' }}"
  notify: restart redis

- name: Configure password for Redis
  action: lineinfile dest=/etc/redis/redis.conf regexp="^(# )+requirepass" backrefs=yes line="requirepass {{ redis_pass }}"
  when: redis_pass is defined
  notify: restart redis

- name: Start and enable Redis server
  service: name=redis-server state=started enabled=yes
